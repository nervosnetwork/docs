<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Scripts · Nervos CKB</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This document introduces how the script works in CKB system, and how can you program scripts to build applications."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Scripts · Nervos CKB"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.nervos.org/"/><meta property="og:description" content="This document introduces how the script works in CKB system, and how can you program scripts to build applications."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-139882771-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-139882771-1');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/nervos-logo.svg" alt="Nervos CKB"/><h2 class="headerTitleWithLogo">Nervos CKB</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://explorer.nervos.org" target="_blank">Explorer</a></li><li class=""><a href="https://github.com/nervosnetwork" target="_blank">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Development Guide</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/introduction/welcome">Welcome</a></li><li class="navListItem"><a class="navItem" href="/introduction/nervos-intro">What is Nervos?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Basic Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/basic-concepts/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/basic-concepts/architecture">CKB Architecture</a></li><li class="navListItem"><a class="navItem" href="/basic-concepts/states-tokens">States and Tokens</a></li><li class="navListItem"><a class="navItem" href="/basic-concepts/node-mining">Node and Mining</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/getting-started/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/getting-started/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/getting-started/wallet">Create a Wallet</a></li><li class="navListItem"><a class="navItem" href="/getting-started/run-node">Run a CKB Node</a></li><li class="navListItem"><a class="navItem" href="/getting-started/mine">Mine Some CK Bytes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Development Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/dev-guide/compile">Compile CKB from Source</a></li><li class="navListItem"><a class="navItem" href="/dev-guide/ruby-sdk">Use Ruby SDK</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/dev-guide/scripts">Scripts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/api/rpc">JSON-RPC Commands</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">References<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/references/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/references/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/references/nervos-design">Nervos System Design</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/nervosnetwork/docs/edit/master/docs/dev-guide/scripts.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Scripts</h1></header><article><div><span><p>This document introduces how the script works in CKB system, and how can you program scripts to build applications.</p>
<p>Please notice that scripts functionality is not stable at the moment. There might be major changes been made to this part in the future. Also the toolchain for scripting is not fully developed yet. So here we only give an introduction to the scripting in CKB.</p>
<h2><a class="anchor" aria-hidden="true" id="script-model"></a><a href="#script-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Script Model</h2>
<p>Both <code>lock</code> script and <code>type</code> script are <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0019-data-structures/0019-data-structures.md#Script"><code>script</code>  data structure</a>, which has two parts: <code>code_hash</code> and <code>args</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="code_hash"></a><a href="#code_hash" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>code_hash</code></h3>
<p><code>code_hash</code> is the hash of a Linux <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> formatted <a href="https://riscv.org/">RISC-V</a> script binary.</p>
<p>The actual script code MUST NOT be put in the <code>script</code> structure directly. Instead, it should always be stored in the <code>data</code> field of a <code>cell</code>.</p>
<p>To use the script code in a <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0019-data-structures/0019-data-structures.md#transaction">transaction</a>, the <code>cell</code> that stores the script code should be used as a <code>deps</code> cell in the transaction. Upon the transaction verification, the CKB client will search the <code>deps</code> cell of this transaction for a cell whose <code>data</code> field has the same hash with the <code>code_hash</code> field. Then this <code>deps</code> cell's <code>data</code> field will be loaded into a CKB-VM instance to be executed as the actual script.</p>
<h3><a class="anchor" aria-hidden="true" id="args"></a><a href="#args" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>args</code></h3>
<p><code>args</code> is an array of arguments as the script input.</p>
<p>CKB scripts use the UNIX standard execution environment. Each script should contain a main function with the following arguments:</p>
<pre><code class="hljs css language-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>;
</code></pre>
<p>For <code>lock</code> script, when the script data is loaded into a CKB-VM instance, along with the <code>args</code> in the <code>lock</code> script, the <code>args</code> in the <code>inputs</code> of the transaction as well as the <code>witness</code> will be concatenated (<code>args</code> in script + <code>args</code> in <code>inputs</code> + <code>witness</code>) and used as input arguments for the script. This group of input arguments will fill in the <code>argc</code>/<code>argv</code> part in the <code>main</code> function. (<code>argc</code> is the number of arguments in <code>args</code> and <code>argv</code> is a pointer that points to the start point of all the input arguments in the memory)</p>
<p>For <code>type</code> script, only the <code>args</code> in its own <code>script</code> structure will be used as input arguments for the script execution.</p>
<h3><a class="anchor" aria-hidden="true" id="script-execution"></a><a href="#script-execution" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Script Execution</h3>
<p>The script is executed in a CKB-VM instance, which is a <a href="https://riscv.org/">RISC-V</a> simulator. To learn more about how the CKB-VM works, please refer <a href="https://github.com/nervosnetwork/rfcs/tree/master/rfcs/0003-ckb-vm">CKB-VM paper</a>.</p>
<p>When the script execution is terminated, the <code>main</code> function of the script should return a code. A return code of <code>0</code> means that the script execution was succeeded, other values may indicate that the execution was failed.</p>
<h2><a class="anchor" aria-hidden="true" id="a-script-example"></a><a href="#a-script-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Script Example</h2>
<p>Here we will show an example script: <a href="https://github.com/nervosnetwork/ckb-system-scripts/blob/master/c/secp256k1_blake160_sighash_all.c">secp256k1_blake160_sighash_all.c</a>.</p>
<p>This script here is used in the <code>lock</code> script. It takes four parameters:</p>
<ul>
<li>The hashed pubkey.</li>
<li>The original pubkey</li>
<li>The transaction signature</li>
<li>The length of the signature</li>
</ul>
<p>The first argument should be stored on-chain inside of the <code>lock</code> script as an <code>args</code>. It will later be used as a proof. Others should be put in transaction <code>witness</code> when you are trying to unlock a <code>lock</code> script.</p>
<blockquote>
<p>The first argument is hashed because in this way the original pubkey does not need to be disclosed on-chain, so that it can achieve privacy to some extend.</p>
</blockquote>
<p>The script's function is to check if the signature of the transaction is indeed signed by the owner of the pubkey. When the script is executed in a CKB-VM instance, it will first verify the pubkey against the hashed pubkey stored on-chain to see if it is valid. Then it will recover the transaction signature and verify it against the pubkey again to check if the transaction is indeed singed by the owner of the pubkey, who is also the owner of the <code>lock</code> script. In this way, the owner of this <code>lock</code> script will be the owner of the cells that are &quot;locked&quot; by this <code>lock</code> script.</p>
<p>Here is the procedure for using this script on CKB. Please note that this is not a step-by-step tutorial. It is just for showing you how this process works.</p>
<ul>
<li>Compile the script to get an ELF format binary file</li>
<li>Deploy a cell that has this binary file in its <code>data</code> field to CKB</li>
<li>Calculate the hash of this binary, which will later be used as the <code>code_hash</code> in the <code>lock</code> script</li>
<li>Calculate the hash of your pubkey, which will later be used as the <code>args</code> in the <code>lock</code> script</li>
</ul>
<p>At the end of the day, you will get a <code>lock</code> script like this:</p>
<pre><code class="hljs css language-json">"lock":{
  "code_hash": "0x9e3b3557f11b2b3532ce352bfe8017e9fd11d154c4c7f9b7aaaa1e621b539a08",
  "args": [
    "0x7f52f0fccdd1d11391c441adfb174f87bca612b0"
  ]
}
</code></pre>
<p>You can send this script to your friend and your friend will be able to send you some CK Bytes by sending a transaction to CKB with an output cell that has this <code>lock</code> script.</p>
<p>To use your cell, you need to construct a transaction with a <code>witness</code> that has your pubkey and transaction signature. It will be something like this:</p>
<pre><code class="hljs css language-json">"witnesses":[{
    "data":[
  "0x024a501efd328e062c8675f2365970728c859c592beeefd6be8ead3d901330bc01",
  "0x3044022038f282cffdd26e2a050d7779ddc29be81a7e2f8a73706d2b7a6fde8a78e950ee0220538657b4c01be3e77827a82e92d33a923e864c55b88fd18cd5e5b25597432e9b"
]
}]
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="scripting-with-other-languages"></a><a href="#scripting-with-other-languages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scripting with Other Languages</h2>
<p>The example showed above is programmed with C. It is also possible to write scripts for CKB using other languages.</p>
<p>Any programming languages supported by <a href="https://riscv.org/">RISC-V</a> toolchain will be able to be used for scripting. This includes high level languages such as Ruby, Javascript and Python.</p>
<p>For example, we can enable scripting using Ruby with <a href="https://github.com/mruby/mruby">mruby</a>, which is the lightweight implementation of the Ruby language.</p>
<p>The way we do it is to run the Ruby script on top of the mruby that is on top of the CKB-VM. When running a ruby script, first the CKB mruby binary will be loaded into a CKB-VM instance, creating a Ruby interpreter environment. Then the ruby script will be entered into the CKB mruby as input arguments, and then the actual arguments to the Ruby scripts will be entered afterward.</p>
<p>It is also possible to do the same thing with <a href="https://micropython.org/">micropython</a> or <a href="https://duktape.org/">duktape</a> to enable writing scripts in Python and Javascript.</p>
<p>This part of function is still under development.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 7/1/2019</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/dev-guide/ruby-sdk"><span class="arrow-prev">← </span><span>Use Ruby SDK</span></a><a class="docs-next button" href="/api/rpc"><span>JSON-RPC Commands</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#script-model">Script Model</a><ul class="toc-headings"><li><a href="#code_hash"><code>code_hash</code></a></li><li><a href="#args"><code>args</code></a></li><li><a href="#script-execution">Script Execution</a></li></ul></li><li><a href="#a-script-example">A Script Example</a></li><li><a href="#scripting-with-other-languages">Scripting with Other Languages</a></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'ef49666369943baa0a93aedc37511318',
                indexName: 'nervos-ckb',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>